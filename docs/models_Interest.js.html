<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: models/Interest.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: models/Interest.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// src/models/interest.js
const FirestoreService = require('../utils/firestoreService');
const FieldValue = require('firebase-admin').firestore.FieldValue;
const dbService = FirestoreService.collection('interests');
const dbServiceUser = FirestoreService.collection('usuario');
const categoriesDbService = FirestoreService.collection('interests_categories');
const { prepareSearchTerms } = require('../utils/searchUtils');
const { logger } = require('../logger');
const admin = require('../firebaseAdmin');

class Interest {
  constructor(data) {
    this.id = data.id;
    this.label = data.label;
    this.categoryId = data.categoryId;
    this.description = data.description || '';
    this.active = data.active !== undefined ? data.active : true;
    this.order = data.order || 0;
    this.createdAt = data.createdAt || new Date();
    this.updatedAt = data.updatedAt || new Date();
  }

  toPlainObject() {
    return {
      id: this.id,
      label: this.label,
      categoryId: this.categoryId,
      description: this.description,
      active: this.active,
      order: this.order,
      createdAt: this.createdAt,
      updatedAt: this.updatedAt
    };
  }

  static async getById(interestId) {
    logger.info('Buscando interesse por ID', { service: 'interestModel', function: 'getById', interestId });
    
    try {
      const interestDoc = await dbService.doc(interestId).get();
      
      if (!interestDoc.exists) {
        logger.warn('Interesse não encontrado', { service: 'interestModel', function: 'getById', interestId });
        return null;
      }
      
      const interestData = interestDoc.data();
      interestData.id = interestId;
      
      return new Interest(interestData);
    } catch (error) {
      logger.error('Erro ao buscar interesse por ID', { 
        service: 'interestModel', 
        function: 'getById', 
        interestId, 
        error: error.message 
      });
      throw new Error('Erro ao buscar interesse por ID');
    }
  }

  static async getInterestsByCategory(categoryId, includeInactive = false) {
    try {
      let query = dbService;
      
      // Filtrar por categoryId
      query = query.where('categoryId', '==', categoryId);
      
      if (!includeInactive) {
        query = query.where('active', '==', true);
      }
      
      query = query.orderBy('order');
      
      const snapshot = await query.get();
      
      const interests = [];
      snapshot.docs.forEach(doc => {
        const data = doc.data();
        data.id = doc.id;
        interests.push(new Interest(data));
      });
      
      return interests;
    } catch (error) {
      logger.error('Erro ao obter interesses por categoria', {
        service: 'interestModel',
        function: 'getInterestsByCategory',
        categoryId,
        error: error.message,
        stack: error.stack
      });
      throw new Error(`Erro ao obter interesses por categoria: ${error.message}`);
    }
  }

  static async createInterest(interestData) {
    
    logger.info('Criando novo interesse', { service: 'interestModel', function: 'createInterest' });
    
    try {
      // Verificar se a categoria existe
      const categoryRef = categoriesDbService.doc(interestData.categoryId);
      const categoryDoc = await categoryRef.get();
      
      if (!categoryDoc.exists) {
        logger.error('Categoria não encontrada', { service: 'interestModel', function: 'createInterest', categoryId: interestData.categoryId });
        throw new Error('Categoria não encontrada');
      }
      
      // Preparar termos de pesquisa para facilitar buscas posteriores
      const searchTerms = [
        interestData.label.toLowerCase(),
        ...interestData.label.toLowerCase().split(' ')
      ];
      
      if (interestData.description) {
        searchTerms.push(...interestData.description.toLowerCase().split(' '));
      }
      
      // Filtrar termos de pesquisa duplicados e muito curtos
      const filteredTerms = [...new Set(searchTerms)].filter(term => term.length > 2);
      
      // Preparar dados do interesse
      const now = new Date();
      const interest = new Interest({
        ...interestData,
        createdAt: now,
        updatedAt: now
      });
      
      const interestToSave = {
        ...interest.toPlainObject(),
        searchTerms: prepareSearchTerms(interest.label + ' ' + interest.description)
      };
      
      // Salvar no Firestore
      const docRef = await dbService.collection('interests').add(interestToSave);
      interest.id = docRef.id;
      
      logger.info('Interesse criado com sucesso', { service: 'interestModel', function: 'createInterest', interestId: interest.id });
      return interest;
    } catch (error) {
      logger.error('Erro ao criar interesse', { service: 'interestModel', function: 'createInterest', error: error.message });
      throw new Error(`Erro ao criar interesse: ${error.message}`);
    }
  }

  static async updateInterest(interestId, updateData) {
    
    logger.info('Atualizando interesse', { service: 'interestModel', function: 'updateInterest', interestId });
    
    try {
      const interestRef = dbService.collection('interests').doc(interestId);
      const interestDoc = await interestRef.get();
      
      if (!interestDoc.exists) {
        logger.warn('Interesse não encontrado para atualização', { service: 'interestModel', function: 'updateInterest', interestId });
        throw new Error('Interesse não encontrado');
      }
      
      // Se o nome ou descrição mudar, atualize os termos de pesquisa
      const currentData = interestDoc.data();
      let searchTerms = currentData.searchTerms || [];
      
      if (updateData.label &amp;&amp; updateData.label !== currentData.label) {
        const labelTerms = [
          updateData.label.toLowerCase(),
          ...updateData.label.toLowerCase().split(' ')
        ];
        searchTerms = [...new Set([...searchTerms, ...labelTerms])].filter(term => term.length > 2);
      }
      
      if (updateData.description &amp;&amp; updateData.description !== currentData.description) {
        const descTerms = updateData.description.toLowerCase().split(' ');
        searchTerms = [...new Set([...searchTerms, ...descTerms])].filter(term => term.length > 2);
      }
      
      // Preparar dados para atualização
      const updatePayload = {
        ...updateData,
        updatedAt: new Date(),
        searchTerms: prepareSearchTerms((updateData.label || currentData.label) + ' ' + (updateData.description || currentData.description))
      };
      
      // Atualizar no Firestore
      await interestRef.update(updatePayload);
      
      // Buscar o documento atualizado
      const updatedDoc = await interestRef.get();
      const updatedData = updatedDoc.data();
      updatedData.id = interestId;
      
      logger.info('Interesse atualizado com sucesso', { service: 'interestModel', function: 'updateInterest', interestId });
      return new Interest(updatedData);
    } catch (error) {
      logger.error('Erro ao atualizar interesse', { service: 'interestModel', function: 'updateInterest', interestId, error: error.message });
      throw new Error(`Erro ao atualizar interesse: ${error.message}`);
    }
  }

/**
 * Fetches a user's interests from their Firestore document
 * Handles both the newer interestIds array format and the legacy interesses map format
 * @param {string} userId - The ID of the user to fetch interests for
 * @returns {Promise&lt;Array>} Array of interest categories with their interests
 */
static async getUserInterests(userId) {
  logger.info('Buscando interesses do usuário', { service: 'interestModel', function: 'getUserInterests', userId });
  
  try {
    // Buscar o usuário
    const userRef = dbServiceUser.doc(userId);
    const userDoc = await userRef.get();
    
    if (!userDoc.exists) {
      logger.warn('Usuário não encontrado', { service: 'interestModel', function: 'getUserInterests', userId });
      throw new Error('Usuário não encontrado');
    }
    
    const userData = userDoc.data();
    
    // Checar ambos os formatos de armazenamento de interesses
    const userInterestIds = userData.interestIds || []; // Novo formato (array plano)
    const userInteresses = userData.interesses || {}; // Formato legado (mapa de categorias)
    
    // Se não houver interesses em nenhum formato, retornar array vazio
    if (userInterestIds.length === 0 &amp;&amp; Object.keys(userInteresses).length === 0) {
      logger.info('Usuário não possui interesses', { service: 'interestModel', function: 'getUserInterests', userId });
      return [];
    }
    
    // Determinar quais IDs de interesses usar (priorizar o novo formato, mas usar o legado se necessário)
    let interestIdsToFetch = [];
    
    if (userInterestIds.length > 0) {
      // Se temos o novo formato, usar ele diretamente
      interestIdsToFetch = userInterestIds;
      logger.info('Usando formato novo (interestIds) para buscar interesses', { 
        service: 'interestModel', 
        function: 'getUserInterests',
        count: interestIdsToFetch.length
      });
    } else {
      // Caso contrário, extrair IDs do formato legado
      Object.values(userInteresses).forEach(categoryInterests => {
        if (Array.isArray(categoryInterests)) {
          categoryInterests.forEach(interestId => {
            if (interestId &amp;&amp; !interestIdsToFetch.includes(interestId)) {
              interestIdsToFetch.push(interestId);
            }
          });
        }
      });
      
      logger.info('Usando formato legado (interesses) para buscar interesses', { 
        service: 'interestModel', 
        function: 'getUserInterests',
        count: interestIdsToFetch.length
      });
    }
    
    // Se não temos interesses para buscar, retornar array vazio
    if (interestIdsToFetch.length === 0) {
      return [];
    }
    
    // Buscar todos os interesses de uma vez (mais eficiente)
    const interestsMap = {};
    
    // Dividir em lotes de 10 para evitar limites do Firestore
    const batchSize = 10;
    for (let i = 0; i &lt; interestIdsToFetch.length; i += batchSize) {
      const batch = interestIdsToFetch.slice(i, i + batchSize);
      
      // Para cada lote, buscar os documentos de interesse
      const interestPromises = batch.map(interestId => 
        dbService.doc(interestId).get()
      );
      
      const interestDocs = await Promise.all(interestPromises);
      
      // Processar cada documento de interesse
      interestDocs.forEach(doc => {
        if (doc.exists) {
          const interestData = doc.data();
          const interestId = doc.id;
          const categoryId = interestData.categoryId;
          
          if (categoryId) {
            if (!interestsMap[categoryId]) {
              interestsMap[categoryId] = {
                categoryId,
                interests: []
              };
            }
            
            // Adicionar o interesse ao seu mapa de categoria
            interestsMap[categoryId].interests.push({
              id: interestId,
              label: interestData.label,
              ...interestData
            });
          }
        }
      });
    }
    
    // Agora, buscar os detalhes das categorias
    const categoryIds = Object.keys(interestsMap);
    const categoryPromises = categoryIds.map(categoryId => 
      categoriesDbService.doc(categoryId).get()
    );
    
    const categoryDocs = await Promise.all(categoryPromises);
    
    // Adicionar os detalhes das categorias
    categoryDocs.forEach(doc => {
      if (doc.exists &amp;&amp; interestsMap[doc.id]) {
        const categoryData = doc.data();
        interestsMap[doc.id].name = categoryData.name;
        interestsMap[doc.id].icon = categoryData.icon;
        interestsMap[doc.id].id = doc.id;
      }
    });
    
    // Converter para array e filtrar categorias sem interesses
    const result = Object.values(interestsMap)
      .filter(category => category.interests &amp;&amp; category.interests.length > 0);
    
    logger.info('Interesses do usuário obtidos com sucesso', { 
      service: 'interestModel', 
      function: 'getUserInterests', 
      userId,
      categoriesCount: result.length,
      interestsCount: result.reduce((sum, cat) => sum + cat.interests.length, 0)
    });
    
    return result;
    
  } catch (error) {
    logger.error('Erro ao buscar interesses do usuário', { 
      service: 'interestModel', 
      function: 'getUserInterests', 
      userId, 
      error: error.message,
      stack: error.stack
    });
    throw new Error(`Erro ao buscar interesses do usuário: ${error.message}`);
  }
}

/**
 * Updates the interests of a user, maintaining both the legacy format (interesses map)
 * and the new format (interestIds array)
 * @param {string} userId - The ID of the user to update
 * @param {Array} interestIds - Array of interest IDs selected by the user
 * @returns {Promise&lt;Object>} Result with success status and updated interest IDs
 */
static async updateUserInterests(userId, interestIds) {
  logger.info('Updating user interests', { 
    service: 'interestModel', 
    function: 'updateUserInterests', 
    userId 
  });
  
  try {
    // Verify if the user exists
    const userRef = dbServiceUser.doc(userId);
    const userDoc = await userRef.get();
    
    if (!userDoc.exists) {
      logger.warn('User not found', { 
        service: 'interestModel', 
        function: 'updateUserInterests', 
        userId 
      });
      throw new Error('User not found');
    }
    
    // Get current user data
    const userData = userDoc.data();
    
    // Validate and filter interest IDs to ensure they exist and are active
    const validInterestIds = [];
    const interestsByCategory = {};
    
    // Process each interest ID
    for (const interestId of interestIds) {
      try {
        const interestDoc = await dbService.doc(interestId).get();
        
        if (interestDoc.exists &amp;&amp; interestDoc.data().active !== false) {
          validInterestIds.push(interestId);
          
          // Group by category for the legacy format
          const interestData = interestDoc.data();
          const categoryId = interestData.categoryId;
          
          if (!interestsByCategory[categoryId]) {
            interestsByCategory[categoryId] = [];
          }
          
          interestsByCategory[categoryId].push(interestId);
        } else {
          logger.warn('Skipping invalid or inactive interest', { 
            service: 'interestModel', 
            function: 'updateUserInterests', 
            interestId 
          });
        }
      } catch (err) {
        logger.warn('Error processing interest', { 
          service: 'interestModel', 
          function: 'updateUserInterests', 
          interestId,
          error: err.message
        });
        // Continue with other interests even if one fails
      }
    }
    
    // // Step 1: Get all categories to build complete structure
    // const categoriesSnapshot = await categoriesDbService.get();
    // const allCategories = {};
    
    // categoriesSnapshot.docs.forEach(doc => {
    //   allCategories[doc.id] = []; // Initialize each category with empty array
    // });
    
    // Step 2: Merge with the user-selected interests
    // const interessesMap = { ...allCategories, ...interestsByCategory };
    
    // Step 3: Update user document with both new and legacy formats
    const updates = {
      // New format - flat array of interest IDs
      interestIds: validInterestIds,
      
      // Legacy format - map of categories to arrays of interest IDs
      interesses: interestsByCategory,
      
      // Update timestamp
      updatedAt: FieldValue.serverTimestamp()
    };
    
    await userRef.update(updates);
    
    logger.info('User interests updated successfully', { 
      service: 'interestModel', 
      function: 'updateUserInterests', 
      userId,
      interestCount: validInterestIds.length,
      categoryCount: Object.keys(interestsByCategory).length
    });
    
    return { 
      success: true, 
      interestIds: validInterestIds,
      categoryCount: Object.keys(interestsByCategory).length
    };
  } catch (error) {
    logger.error('Error updating user interests', { 
      service: 'interestModel', 
      function: 'updateUserInterests', 
      userId, 
      error: error.message,
      stack: error.stack
    });
    throw new Error(`Failed to update user interests: ${error.message}`);
  }
}
  
  static async getAllInterestsFlat() {
    
    logger.info('Buscando todos os interesses em formato plano', { 
      service: 'interestModel', 
      function: 'getAllInterestsFlat'
    });
    
    try {
      const snapshot = await dbService
        .where('active', '==', true)
        .get();
      
      const interests = [];
      snapshot.docs.forEach(doc => {
        const data = doc.data();
        data.id = doc.id;
        interests.push(new Interest(data).toPlainObject());
      });
      
      logger.info('Interesses obtidos com sucesso', { 
        service: 'interestModel', 
        function: 'getAllInterestsFlat',
        count: interests.length
      });
      
      return interests;
    } catch (error) {
      logger.error('Erro ao obter todos os interesses', { 
        service: 'interestModel', 
        function: 'getAllInterestsFlat', 
        error: error.message 
      });
      throw new Error('Erro ao obter todos os interesses');
    }
  }

  static async calculateInterestStatistics() {
    const db = admin.getFirestore();
    logger.info('Calculando estatísticas de interesses', { service: 'interestStatsService', function: 'calculateInterestStatistics' });

    try {
      // Buscar todos os usuários
      const usersSnapshot = await dbServiceUser.get();

      // Mapa para contar ocorrências de cada interesse
      const interestCounts = {};

      // Processar cada usuário
      usersSnapshot.docs.forEach(doc => {
        const userData = doc.data();

        // Novo formato
        if (userData.interestIds &amp;&amp; Array.isArray(userData.interestIds)) {
          userData.interestIds.forEach(interestId => {
            interestCounts[interestId] = (interestCounts[interestId] || 0) + 1;
          });
        }
        // Formato antigo
        else if (userData.interesses) {
          Object.values(userData.interesses).forEach(categoryInterests => {
            if (Array.isArray(categoryInterests)) {
              categoryInterests.forEach(interestId => {
                interestCounts[interestId] = (interestCounts[interestId] || 0) + 1;
              });
            }
          });
        }
      });

      // Obter detalhes dos interesses
      const interestIds = Object.keys(interestCounts);
      const interestDetails = [];

      for (const interestId of interestIds) {
        const interest = await this.getById(interestId);
        if (interest) {
          interestDetails.push({
            id: interestId,
            label: interest.label,
            categoryId: interest.categoryId,
            count: interestCounts[interestId]
          });
        }
      }

      // Ordenar por contagem (mais populares primeiro)
      interestDetails.sort((a, b) => b.count - a.count);

      return {
        totalUsers: usersSnapshot.size,
        data: interestDetails
      };
    } catch (error) {
      logger.error('Erro ao calcular estatísticas de interesses', {
        service: 'interestStatsService',
        function: 'calculateInterestStatistics',
        error: error.message
      });
      throw new Error('Erro ao calcular estatísticas de interesses');
    }
  }
}

module.exports = Interest;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-controllers_authController.html">controllers/authController</a></li><li><a href="module-controllers_blacklistController.html">controllers/blacklistController</a></li><li><a href="module-controllers_connectionsController.html">controllers/connectionsController</a></li><li><a href="module-controllers_emailController.html">controllers/emailController</a></li><li><a href="module-controllers_groupsCaixinhaController.html">controllers/groupsCaixinhaController</a></li><li><a href="module-controllers_interestsController.html">controllers/interestsController</a></li><li><a href="module-controllers_inviteController.html">controllers/inviteController</a></li><li><a href="module-controllers_notificationsController.html">controllers/notificationsController</a></li><li><a href="module-controllers_openaiController.html">controllers/openaiController</a></li><li><a href="module-controllers_permissionController.html">controllers/permissionController</a></li><li><a href="module-controllers_postController.html">controllers/postController</a></li><li><a href="module-controllers_recaptchaController.html">controllers/recaptchaController</a></li><li><a href="module-controllers_rifaController.html">controllers/rifaController</a></li><li><a href="module-controllers_roleController.html">controllers/roleController</a></li><li><a href="module-controllers_userController.html">controllers/userController</a></li><li><a href="module-controllers_videoSdkController.html">controllers/videoSdkController</a></li><li><a href="module-services_CaixinhaInviteService.html">services/CaixinhaInviteService</a></li><li><a href="module-services_SupportService.html">services/SupportService</a></li><li><a href="module-services_authService.html">services/authService</a></li><li><a href="module-services_blacklistService.html">services/blacklistService</a></li><li><a href="module-services_caixinhaService.html">services/caixinhaService</a></li><li><a href="module-services_connectionService.html">services/connectionService</a></li><li><a href="module-services_contribuicaoService.html">services/contribuicaoService</a></li><li><a href="module-services_disputeService.html">services/disputeService</a></li><li><a href="module-services_emailService.html">services/emailService</a></li><li><a href="module-services_encryptionService.html">services/encryptionService</a></li><li><a href="module-services_inviteService.html">services/inviteService</a></li><li><a href="module-services_ja3Service.html">services/ja3Service</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-services_emailService-emailService.html">emailService</a></li></ul><h3>Classes</h3><ul><li><a href="AppError.html">AppError</a></li><li><a href="AuthenticationError.html">AuthenticationError</a></li><li><a href="ConflictError.html">ConflictError</a></li><li><a href="ForbiddenError.html">ForbiddenError</a></li><li><a href="HttpError.html">HttpError</a></li><li><a href="Invite.html">Invite</a></li><li><a href="Message.html">Message</a></li><li><a href="NotFoundError.html">NotFoundError</a></li><li><a href="PermissionService.html">PermissionService</a></li><li><a href="RateLimitError.html">RateLimitError</a></li><li><a href="RoleService.html">RoleService</a></li><li><a href="ServiceError.html">ServiceError</a></li><li><a href="UserRoleService.html">UserRoleService</a></li><li><a href="ValidationError.html">ValidationError</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_calculateSimilarity">_calculateSimilarity</a></li><li><a href="global.html#_findPendingAccountsForPayment">_findPendingAccountsForPayment</a></li><li><a href="global.html#_levenshteinDistance">_levenshteinDistance</a></li><li><a href="global.html#_processPaymentNotification">_processPaymentNotification</a></li><li><a href="global.html#_validatePayerData">_validatePayerData</a></li><li><a href="global.html#_verifyWebhookSignature">_verifyWebhookSignature</a></li><li><a href="global.html#acceptInvite">acceptInvite</a></li><li><a href="global.html#activateBankAccount">activateBankAccount</a></li><li><a href="global.html#addContribuicao">addContribuicao</a></li><li><a href="global.html#approveLoan">approveLoan</a></li><li><a href="global.html#assignRoleToUser">assignRoleToUser</a></li><li><a href="global.html#asyncHandler">asyncHandler</a></li><li><a href="global.html#broadcastUserStatus">broadcastUserStatus</a></li><li><a href="global.html#cancelDispute">cancelDispute</a></li><li><a href="global.html#cancelInvite">cancelInvite</a></li><li><a href="global.html#cancelarRifa">cancelarRifa</a></li><li><a href="global.html#checkAuthService">checkAuthService</a></li><li><a href="global.html#checkBankValidation">checkBankValidation</a></li><li><a href="global.html#checkCaixinhaService">checkCaixinhaService</a></li><li><a href="global.html#checkConnectionsService">checkConnectionsService</a></li><li><a href="global.html#checkDatabaseConnection">checkDatabaseConnection</a></li><li><a href="global.html#checkDependencies">checkDependencies</a></li><li><a href="global.html#checkDisputeRequirement">checkDisputeRequirement</a></li><li><a href="global.html#checkExpiredInvites">checkExpiredInvites</a></li><li><a href="global.html#checkFirebaseConnection">checkFirebaseConnection</a></li><li><a href="global.html#checkFullSystem">checkFullSystem</a></li><li><a href="global.html#checkInterestsService">checkInterestsService</a></li><li><a href="global.html#checkNotificationsService">checkNotificationsService</a></li><li><a href="global.html#checkPermission">checkPermission</a></li><li><a href="global.html#checkPublicServices">checkPublicServices</a></li><li><a href="global.html#checkRole">checkRole</a></li><li><a href="global.html#checkServerResources">checkServerResources</a></li><li><a href="global.html#checkServices">checkServices</a></li><li><a href="global.html#checkSpecificService">checkSpecificService</a></li><li><a href="global.html#checkUserService">checkUserService</a></li><li><a href="global.html#confirmBankValidation">confirmBankValidation</a></li><li><a href="global.html#createBankAccount">createBankAccount</a></li><li><a href="global.html#createCaixinha">createCaixinha</a></li><li><a href="global.html#createDispute">createDispute</a></li><li><a href="global.html#createHealthResponse">createHealthResponse</a></li><li><a href="global.html#createRifa">createRifa</a></li><li><a href="global.html#createRuleChangeDispute">createRuleChangeDispute</a></li><li><a href="global.html#deleteBankAccount">deleteBankAccount</a></li><li><a href="global.html#deleteCaixinha">deleteCaixinha</a></li><li><a href="global.html#dependenciesHealthCheck">dependenciesHealthCheck</a></li><li><a href="global.html#detectDeviceType">detectDeviceType</a></li><li><a href="global.html#determineOverallStatus">determineOverallStatus</a></li><li><a href="global.html#evaluateThreshold">evaluateThreshold</a></li><li><a href="global.html#extractToken">extractToken</a></li><li><a href="global.html#formatErrorForHealthResponse">formatErrorForHealthResponse</a></li><li><a href="global.html#fullSystemHealthCheck">fullSystemHealthCheck</a></li><li><a href="global.html#generateValidationCode">generateValidationCode</a></li><li><a href="global.html#generateValidationPix">generateValidationPix</a></li><li><a href="global.html#gerarComprovante">gerarComprovante</a></li><li><a href="global.html#gerarComprovanteSorteio">gerarComprovanteSorteio</a></li><li><a href="global.html#gerarHashVerificacao">gerarHashVerificacao</a></li><li><a href="global.html#gerarRelatorio">gerarRelatorio</a></li><li><a href="global.html#gerenciarEmprestimos">gerenciarEmprestimos</a></li><li><a href="global.html#gerenciarMembros">gerenciarMembros</a></li><li><a href="global.html#getAccountHistory">getAccountHistory</a></li><li><a href="global.html#getAllBankAccounts">getAllBankAccounts</a></li><li><a href="global.html#getAllRifasByCaixinha">getAllRifasByCaixinha</a></li><li><a href="global.html#getCaixinhaById">getCaixinhaById</a></li><li><a href="global.html#getCaixinhaInvites">getCaixinhaInvites</a></li><li><a href="global.html#getCaixinhas">getCaixinhas</a></li><li><a href="global.html#getDisputeById">getDisputeById</a></li><li><a href="global.html#getDisputeVoteInfo">getDisputeVoteInfo</a></li><li><a href="global.html#getDisputes">getDisputes</a></li><li><a href="global.html#getInvitationsByType">getInvitationsByType</a></li><li><a href="global.html#getInviteDetails">getInviteDetails</a></li><li><a href="global.html#getLoanById">getLoanById</a></li><li><a href="global.html#getLoanStats">getLoanStats</a></li><li><a href="global.html#getLoans">getLoans</a></li><li><a href="global.html#getMembers">getMembers</a></li><li><a href="global.html#getReceivedInvites">getReceivedInvites</a></li><li><a href="global.html#getRifaById">getRifaById</a></li><li><a href="global.html#getSentInvites">getSentInvites</a></li><li><a href="global.html#getUserRoles">getUserRoles</a></li><li><a href="global.html#getUserStatus">getUserStatus</a></li><li><a href="global.html#healthCheck">healthCheck</a></li><li><a href="global.html#initBankValidation">initBankValidation</a></li><li><a href="global.html#initializeFirstAdmin">initializeFirstAdmin</a></li><li><a href="global.html#initializeLocalStorage">initializeLocalStorage</a></li><li><a href="global.html#injectRoleInfo">injectRoleInfo</a></li><li><a href="global.html#inviteByEmail">inviteByEmail</a></li><li><a href="global.html#inviteExistingMember">inviteExistingMember</a></li><li><a href="global.html#isAdmin">isAdmin</a></li><li><a href="global.html#isUserOnline">isUserOnline</a></li><li><a href="global.html#listCollections">listCollections</a></li><li><a href="global.html#logServiceStatus">logServiceStatus</a></li><li><a href="global.html#makePayment">makePayment</a></li><li><a href="global.html#mercadoPagoWebhook">mercadoPagoWebhook</a></li><li><a href="global.html#migrateAdminUsers">migrateAdminUsers</a></li><li><a href="global.html#migrateInvitesToNewStructure">migrateInvitesToNewStructure</a></li><li><a href="global.html#obterNumeroAleatorioNIST">obterNumeroAleatorioNIST</a></li><li><a href="global.html#obterNumeroAleatorioRandomOrg">obterNumeroAleatorioRandomOrg</a></li><li><a href="global.html#obterResultadoLoteria">obterResultadoLoteria</a></li><li><a href="global.html#optionalAuth">optionalAuth</a></li><li><a href="global.html#parseCookies">parseCookies</a></li><li><a href="global.html#publicHealthCheck">publicHealthCheck</a></li><li><a href="global.html#realizarSorteio">realizarSorteio</a></li><li><a href="global.html#registerMessageHandlers">registerMessageHandlers</a></li><li><a href="global.html#registerNotificationHandlers">registerNotificationHandlers</a></li><li><a href="global.html#registerPresenceHandlers">registerPresenceHandlers</a></li><li><a href="global.html#rejectInvite">rejectInvite</a></li><li><a href="global.html#rejectLoan">rejectLoan</a></li><li><a href="global.html#rejectUserRole">rejectUserRole</a></li><li><a href="global.html#removeRoleFromUser">removeRoleFromUser</a></li><li><a href="global.html#requestLoan">requestLoan</a></li><li><a href="global.html#resendInvite">resendInvite</a></li><li><a href="global.html#resendInviteEmail">resendInviteEmail</a></li><li><a href="global.html#sendAlertsIfNeeded">sendAlertsIfNeeded</a></li><li><a href="global.html#sendRealTimeNotification">sendRealTimeNotification</a></li><li><a href="global.html#serviceCheckers">serviceCheckers</a></li><li><a href="global.html#serviceHealthCheck">serviceHealthCheck</a></li><li><a href="global.html#setupActivityMonitor">setupActivityMonitor</a></li><li><a href="global.html#setupGracefulShutdown">setupGracefulShutdown</a></li><li><a href="global.html#setupHealthMonitoring">setupHealthMonitoring</a></li><li><a href="global.html#setupSystemMonitoring">setupSystemMonitoring</a></li><li><a href="global.html#socketAuthMiddleware">socketAuthMiddleware</a></li><li><a href="global.html#socketLoggingMiddleware">socketLoggingMiddleware</a></li><li><a href="global.html#updateBankAccount">updateBankAccount</a></li><li><a href="global.html#updateCaixinha">updateCaixinha</a></li><li><a href="global.html#updateRifa">updateRifa</a></li><li><a href="global.html#updateUserStatus">updateUserStatus</a></li><li><a href="global.html#validateAccount">validateAccount</a></li><li><a href="global.html#validateUserRole">validateUserRole</a></li><li><a href="global.html#venderBilhete">venderBilhete</a></li><li><a href="global.html#verificarAutenticidadeSorteio">verificarAutenticidadeSorteio</a></li><li><a href="global.html#verificarConfiguracoes">verificarConfiguracoes</a></li><li><a href="global.html#verificarIntegridade">verificarIntegridade</a></li><li><a href="global.html#voteOnDispute">voteOnDispute</a></li><li><a href="global.html#webhookLogger">webhookLogger</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Tue Jun 24 2025 14:11:53 GMT-0300 (Brasilia Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
